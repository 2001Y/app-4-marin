# =============================================================================
# CloudKit schema v5 (2025-09-09)
# å‰æ:
# - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯ Private DB (MyProfilePrivate) ã®ã¿ã€‚ä»–äººã‹ã‚‰ã¯ä¸å¯è¦–ã€‚
# - å„ãƒ«ãƒ¼ãƒ  = 1 å…±æœ‰ã‚¾ãƒ¼ãƒ³ (pattern: room_* )ã€‚Room ã‚’è¦ªã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ parent ã§ã¶ã‚‰ä¸‹ã’ã€‚
# - ãƒ«ãƒ¼ãƒ ä¸€è¦§ã¯ Private DB ã® RoomListEntryï¼ˆæ¨ªæ–­ã‚½ãƒ¼ãƒˆ/æœªèª­ç®¡ç†ã®ãŸã‚ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰ã€‚
# - æ—¥ä»˜ç³»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æŒãŸãšã€æ™‚åˆ»ã¯ creationDate / modificationDateï¼ˆã‚·ã‚¹ãƒ†ãƒ ï¼‰ã ã‘ã‚’ä½¿ç”¨ã€‚
# - Reaction/Attachment ã¯ Message ã®å­ã€‚MessageAttachment.type ã¯ ['image','video'] ã«é™å®šã€‚
# - å‚åŠ /æ‹›å¾…ã®æ¨©é™ã¯ã€Œèª°ã§ã‚‚å¯ã€ã€‚ownerUserRef ã‚„ role/membership ã¯æŒãŸãªã„ã€‚
# - userId ã¯ CloudKit ã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆCKRecordTypeUserRecordï¼‰ã€ã® recordID.recordName ã‚’æ¡ç”¨ï¼ˆç«¯æœ«/OSã‚’è·¨ã„ã§ä¸å¤‰ï¼‰ã€‚
# - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã« faceTimeIDï¼ˆãƒ¡ãƒ¼ãƒ« or é›»è©±ç•ªå·ï¼‰ã‚’è¿½åŠ ã€‚â€»Privateå°‚ç”¨ã€‚å…±æœ‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¯å«ã‚ãªã„ã€‚
#   - ç”¨é€”ä¾‹ï¼šã‚¢ãƒ—ãƒªå†…ã‹ã‚‰ facetime: / facetime-audio: URL ã‚¹ã‚­ãƒ¼ãƒ ã§FaceTimeã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®è‡ªå·±ç”¨ãƒ¡ãƒ¢ã€‚
# =============================================================================

schema:
  version: 5
  notes: >
    æœ€å°ãƒ»è¡çªå°‘ãƒ»é‹ç”¨å®¹æ˜“ã‚’å„ªå…ˆã€‚æ¨ªæ–­ä¸€è¦§ã¯ Private ã® RoomListEntry ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚
    ä¸¦ã³ãƒ»åˆ¤å®šã®æ™‚åˆ»ã¯ã™ã¹ã¦ creationDate / modificationDate ã‚’å‚ç…§ã€‚

databases:

  private:
    zones:
      - name: app.private
        record_types:

          - name: MyProfilePrivate
            fields:
              # userId ã¯ CKContainer.fetchUserRecordID() ã®æˆ»ã‚Šå€¤ recordName ã‚’ä¿å­˜
              - { name: userId,        type: String, required: true }
              - { name: displayName,   type: String, required: true }
              - { name: avatarAsset,   type: Asset,  required: false }
              # FaceTimeç”¨ã®è­˜åˆ¥å­ï¼ˆãƒ¡ãƒ¼ãƒ« or é›»è©±ç•ªå·ï¼‰ã€‚å¤–éƒ¨å…±æœ‰ã—ãªã„å‰æï¼ˆPrivateå°‚ç”¨ï¼‰
              # â€» å¿…è¦ã«å¿œã˜ã¦ facetime: / facetime-audio: URL ã‚¹ã‚­ãƒ¼ãƒ ã§èµ·å‹•ã«åˆ©ç”¨
              - { name: faceTimeID,    type: String, required: false }
            indexes:
              - { fields: [userId], order: asc }

          - name: RoomListEntry
            fields:
              - { name: sharedZoneOwnerName, type: String, required: true }  # å…±æœ‰ã‚¾ãƒ¼ãƒ³ã® ownerNameï¼ˆä¾‹: "__CKUSER__â€¦")
              - { name: sharedZoneName,      type: String, required: true }  # ä¾‹: "room_g32wf23f1"
              - { name: roomRecordName,      type: String, required: true }  # Room ãƒ¬ã‚³ãƒ¼ãƒ‰å
              - { name: roomName,            type: String, required: true }
              - { name: roomImageAsset,      type: Asset,  required: false }
              - { name: lastMessageText,     type: String, required: false }
              - { name: lastMessageAt,       type: Date,   required: false }
              - { name: lastReadAt,          type: Date,   required: false }
              - { name: unreadCount,         type: Int64,  required: false } # ã‚­ãƒ£ãƒƒã‚·ãƒ¥å€¤ï¼ˆæœ€çµ‚çš„ãªçœŸå®Ÿã¯ lastReadAt ã¨ Message.creationDate ã§ç®—å‡ºï¼‰
            indexes:
              - { fields: [sharedZoneOwnerName, sharedZoneName, roomRecordName], order: asc }
              - { fields: [lastMessageAt], order: desc }
            # å…±æœ‰DBã‚’æ¨ªæ–­ã—ãŸå³æ™‚é›†ç´„ã¯é›£ã—ã„ãŸã‚ã€ä¸€è¦§/æœªèª­ã¯ Private å´ã§å†ªç­‰æ›´æ–°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥
            # æ—¢èª­ã¯ã€Œãƒãƒ£ãƒƒãƒˆã‚’é–‹ã„ãŸæ™‚ç‚¹ã€ã§ lastReadAt ã‚’å³æ™‚æ›´æ–°ï¼ˆé–‰ã˜ã‚‹ã¾ã§ã®é–“ã«å±Šã„ãŸåˆ†ã¯æ¬¡å›ã§è£œæ­£ï¼‰

  shared:
    zones:
      - pattern: "room_*"
        # å…±æœ‰(Sharing)ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¾ãƒ¼ãƒ³å‰æã€‚å„ãƒ«ãƒ¼ãƒ =1ã‚¾ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€åŒæœŸãƒ»é€šçŸ¥ãƒ»æ¨©é™ã‚’ãƒ«ãƒ¼ãƒ å˜ä½ã§ç‹¬ç«‹ç®¡ç†ã€‚

        record_types:

          # ----------------------------------------------------------
          # ãƒ«ãƒ¼ãƒ ï¼ˆå…±æœ‰ãƒ«ãƒ¼ãƒˆï¼‰
          # â€» UIã§â€œä½œæˆè€…â€ã‚’å‡ºã™å¿…è¦ãŒã‚ã‚Œã°ã€CKShare.owner ã‚’éƒ½åº¦å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹ï¼ˆRoom ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã¯ä¿æŒã—ãªã„ï¼‰
          # ----------------------------------------------------------
          - name: Room
            fields:
              - { name: roomID,          type: String, required: true,  comment: "ã‚¾ãƒ¼ãƒ³å (= shared zoneName) ã‚’å†ªç­‰å‚ç…§ç”¨ã«ä¿æŒ" }
              - { name: name,            type: String, required: true }
              - { name: shareURL,        type: String, required: false } # å…±æœ‰ãƒªãƒ³ã‚¯ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆå®Ÿä½“ã¯ CKShare.urlï¼‰
              - { name: roomImageAsset,  type: Asset,  required: false,  comment: "éƒ¨å±‹ç”»åƒï¼ˆãã‚ŠæŠœãï¼roomImageShapeï¼‰ã€ }
              - { name: roomImageShape,  type: Int64,  required: false,  comment: "0..4 ã®å®‰å®šå½¢çŠ¶ã€‚roomImageAsset ã®ãã‚ŠæŠœãå½¢çŠ¶" }
            # ã“ã“ã‚’è¦ª(parent)ã«ã€ä¸‹ä½ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ã¦ã¶ã‚‰ä¸‹ã’ã‚‹

          - name: RoomMember
            fields:
              # userId ã¯å‚åŠ è€…ã® userRecordID.recordNameï¼ˆå…±æœ‰ã® participants ã‹ã‚‰å¾—ã‚‰ã‚Œã‚‹ï¼‰
              - { name: userId,       type: String, required: true }
              - { name: displayName,  type: String, required: true }
              - { name: avatarAsset,  type: Asset,  required: false }
              - { name: faceTimeID,   type: String, required: false,  comment: "ãƒ¡ãƒ³ãƒãƒ¼ã®FaceTimeè­˜åˆ¥å­ï¼ˆãƒ¡ãƒ¼ãƒ«/é›»è©±ï¼‰ã€‚UIç™ºå‘¼ã«åˆ©ç”¨" }
            parent: Room
            indexes:
              - { fields: [userId], order: asc }
            app_enforced_uniques:
              - [parent(Room), userId]  # 1ãƒ«ãƒ¼ãƒ ã«ã¤ããƒ¦ãƒ¼ã‚¶ã¯ä¸€æ„ï¼ˆã‚¢ãƒ—ãƒªå´ã§é‡è¤‡ä½œæˆã‚’é˜²æ­¢ï¼‰

          - name: Message
            fields:
              - { name: senderMemberRef, type: Reference(RoomMember), required: false, comment: "system ã®å ´åˆ null" }
              - { name: type,            type: String,                required: true,  enum: ['txt','attachment'] }
              - { name: text,            type: String,                required: false }
            # æ·»ä»˜ã¯ MessageAttachment ã«å®Œå…¨åˆ†é›¢ï¼ˆMessage è‡ªä½“ã¯ CKAsset ã‚’æŒãŸãªã„ï¼‰
            parent: Room
            indexes:
              # æ–°ç€/æœªèª­è¨ˆç®—ã§ creationDate ã‚’ä½¿ã†æƒ³å®šã€‚å¿…è¦ã«å¿œã˜ã¦ Console ã§ Queryable ã‚’æœ‰åŠ¹åŒ–
              - { fields: [creationDate], order: desc, queryable: true }
            # ä¸¦ã³ã®å®Œå…¨å®‰å®š: recordName ã« ULID ã‚’æ¡ç”¨ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ (creationDate desc, recordName desc) ã§å®‰å®šåŒ–

          - name: MessageAttachment
            fields:
              # è¦ªå‰Šé™¤ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰ç”¨ã®é€šå¸¸å‚ç…§ï¼ˆparent ã¯ deleteSelf æŒ‡å®šä¸å¯ã®ãŸã‚ï¼‰
              - { name: messageRef, type: Reference(Message, action: 'deleteSelf'), required: true }
              - { name: type,   type: String, required: true, enum: ['image','video'] }
              - { name: asset,  type: Asset,  required: true }  # å¤§å®¹é‡ã¯ Asset ã§ä¿æŒï¼ˆãƒ¬ã‚³ãƒ¼ãƒ‰æœ¬ä½“ã¯1MBåˆ¶é™ï¼‰
            parent: Message

          - name: Reaction
            fields:
              - { name: messageRef, type: Reference(Message, action: 'deleteSelf'), required: true } # è¦ªå‰Šé™¤ã§è‡ªå‹•æ¶ˆå»
              - { name: memberRef, type: Reference(RoomMember), required: true }
              - { name: emoji,     type: String,                required: true }
            parent: Message
            app_enforced_uniques:
              - [parent(Message), memberRef, emoji]  # åŒä¸€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åŒä¸€ãƒ¦ãƒ¼ã‚¶ã®åŒä¸€çµµæ–‡å­—ã¯ä¸€æ„ï¼ˆã‚¢ãƒ—ãƒªå´ã§æ‹…ä¿ï¼‰

          - name: Anniversary
            fields:
              - { name: title, type: String, required: true }
              - { name: date,  type: Date,   required: true }   # æ¬¡å›è¨ˆç®—ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
            parent: Room
            indexes:
              - { fields: [date], order: asc, queryable: true }

          - name: RTCSignal
            fields:
              - { name: fromMemberRef, type: Reference(RoomMember), required: true }
              - { name: toMemberRef,   type: Reference(RoomMember), required: true }
              - { name: callId,        type: String,                required: true,  comment: "åŒæ™‚é€šè©±è­˜åˆ¥å­ã€‚å¤šé‡é€šè©±/èª¤å–è¾¼å›é¿ã«ä½¿ç”¨" }
              - { name: type,          type: String,                required: true, enum: ['offer','answer','ice'] }
              - { name: payload,       type: String,                required: true }
              - { name: consumed,      type: Bool,                  required: true,  default: false }
              - { name: ttlSeconds,    type: Int64,                 required: false }
            parent: Room
            indexes:
              - { fields: [toMemberRef],   queryable: true }
              - { fields: [callId],        queryable: true }
              - { fields: [consumed],      queryable: true }
              - { fields: [creationDate],  order: desc, queryable: true }
            # å–è¾¼å¾Œã¯ consumed=trueã€‚å¤ã„ ICE/ä¿¡å·ã¯ ttlSeconds ã¨ creationDate ã‚’åŸºæº–ã«å®šæœŸå‰Šé™¤ï¼ˆã‚µãƒ¼ãƒå´TTLã¯ç„¡ã„ï¼‰

subscriptions:
  # å…±æœ‰DBã§ã¯ CKQuerySubscription ãŒä½¿ãˆãªã„ãŸã‚ã€Database / RecordZone ã‚µãƒ–ã‚¹ã‚¯ã§å·®åˆ†å–å¾—ã‚’ãƒˆãƒªã‚¬
  - name: room_zone_changes
    scope: "per-room-zone"
    type: RecordZoneSubscription
    notificationInfo:
      shouldSendContentAvailable: true
    # é‹ç”¨: ãƒ«ãƒ¼ãƒ å‚åŠ æ™‚ã«å½“è©²å…±æœ‰ã‚¾ãƒ¼ãƒ³ã¸è³¼èª­ã‚’ä½œæˆã€‚é€€å®¤æ™‚ã«å‰Šé™¤ã€‚

  - name: shared_db_changes
    scope: "shared-database"
    type: DatabaseSubscription
    notificationInfo:
      shouldSendContentAvailable: true
    # é‹ç”¨: æ–°è¦å…±æœ‰ã®å—è«¾/ã‚¾ãƒ¼ãƒ³å¢—æ¸›ã‚’æ¤œçŸ¥â†’æ–°ã‚¾ãƒ¼ãƒ³ã« RecordZoneSubscription ã‚’å¼µã‚‹ã€‚

app_level_rules:
  - rule: "Room ã‚’è¦ªã«ã™ã¹ã¦ã®å­ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é…ç½®ï¼ˆroomRefã¯æŒãŸãªã„ï¼‰"
  - rule: "æ™‚åˆ»ã¯ creationDate / modificationDate ã®ã¿ã‚’çœŸå®Ÿã¨ã—ã¦ä½¿ç”¨ï¼ˆå¿…è¦ãªã‚‰ creationDate ã‚’ Queryable ã«ï¼‰"
  - rule: "RoomMember ã¯å‰Šé™¤å¯ã€‚éå»ã®å‚ç…§ã¯ UI ã§â€œåç„¡ã—â€è¡¨ç¤ºã‚’è¨±å®¹ï¼ˆsenderMemberRef ãŒåˆ‡ã‚Œã¦ã‚‚è‡´å‘½ã§ã¯ãªã„ï¼‰"
  - rule: "é€€å®¤æ™‚ã¯ RTCSignal ã®è‡ªåˆ†å®›è³¼èª­ã‚’å¿…ãšç ´æ£„"
  - rule: "æœªèª­ã¯ RoomListEntry.lastReadAt ã¨ Message.creationDate ã§ç®—å‡ºï¼ˆunreadCount ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰"
  - rule: "RoomListEntry.lastMessageText/At ã¯æ–°ç€Messageé€šçŸ¥å—é ˜æ™‚ã«å†ªç­‰æ›´æ–°"
  - rule: "Message å‰Šé™¤æ™‚ã¯å­(Reaction/Attachment)ã®é€£é–å‰Šé™¤ï¼šdeleteSelf å‚ç…§ï¼‹å¿…è¦ã«å¿œã˜ CKModifyRecordsOperation åŒæ™‚å®Ÿè¡Œ"
  - rule: "RTCSignal ã¯å–è¾¼å¾Œ consumed=trueã€å¤ã„ã‚‚ã®ã¯ ttlSeconds / creationDate ã§å®šæœŸå‰Šé™¤ï¼ˆã‚µãƒ¼ãƒTTLãªã—ï¼‰"
  - rule: "recordName ã« ULID/UUID ã‚’æ¡ç”¨ã—å†ªç­‰ä¿å­˜ï¼ˆå†é€é‡è¤‡ã‚’å›é¿ï¼‰"
  - rule: "IDãƒãƒªã‚·ãƒ¼: userId ã¯ userRecordID.recordNameï¼ˆè‡ªåˆ†=fetchUserRecordIDã€ç›¸æ‰‹=CKShare.participants çµŒç”±ï¼‰"
  - rule: "faceTimeID ã¯ Private ã«ã®ã¿ä¿æŒï¼ˆå…±æœ‰ãƒ‡ãƒ¼ã‚¿ã«å«ã‚ãªã„ï¼‰"

# -----------------------------------------------------------------------------
# é‹ç”¨ãƒ¡ãƒ¢ï¼ˆå®Ÿè£…tipsï¼‰
# - â€œä½œæˆè€…â€è¡¨ç¤ºãŒå¿…è¦ã«ãªã£ãŸã‚‰: ãã® Room ã® CKShare.owner ã‚’éƒ½åº¦å–å¾—ã—ã¦ UI ã«è¡¨ç¤ºï¼ˆRoom ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã¯æŒãŸãªã„ï¼‰ã€‚
# - RoomList ã®æœªèª­: lastReadAt ã‚’å…¥é€€å®¤ã‚„ãƒ•ã‚©ã‚¢/ãƒãƒƒã‚¯åˆ‡æ›¿æ™‚ã«æ›´æ–°ã€‚å³å¯†å€‹æ•°ãŒå¿…è¦ãªã‚‰é€šçŸ¥ã”ã¨ã«åŠ ç®—ã—ã€å…¥å®¤æ™‚ã«å†è¨ˆç®—ã§æ•´åˆã€‚
# - æ·»ä»˜: ãƒ¬ã‚³ãƒ¼ãƒ‰æœ¬ä½“ã¯ ~1MB åˆ¶é™ã€‚ç”»åƒ/å‹•ç”»ãªã©ã¯ CKAsset ã§ä¿æŒã—ã€UIã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é…å»¶ã«é…æ…®ã€‚
# - é€šçŸ¥ã¯åˆæµ/çœç•¥ã•ã‚Œå¾—ã‚‹ãŸã‚ã€push ã¯ã‚ãã¾ã§ãƒˆãƒªã‚¬ã€‚å¸¸ã« fetch*Changes ã§å·®åˆ†åŒæœŸã—ã¦æœ€çµ‚æ•´åˆã‚’å–ã‚‹ã€‚
# - WebRTC: ICE ã¯ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå¢—ãˆã‚„ã™ã„ã€‚payload é–“å¼•ã/ãƒãƒƒãƒåŒ–ï¼‹TTL/consumed ã§æƒé™¤ã€‚
# - FaceTime: faceTimeIDï¼ˆè‡ªåˆ†ã®ãƒ¡ãƒ¼ãƒ«/é›»è©±ï¼‰ã‚’æŒã£ã¦ã„ã‚Œã°ã€å¿…è¦ã«å¿œã˜ã¦ facetime: / facetime-audio: ã§å¤–éƒ¨ã‚¢ãƒ—ãƒªèµ·å‹•ãŒå¯èƒ½ï¼ˆç›¸æ‰‹ã®FaceTimeé€£çµ¡å…ˆã¯è‡ªå‹•å–å¾—ä¸å¯ï¼‰ã€‚
# -----------------------------------------------------------------------------

examples:
  private:
    MyProfilePrivate:
      - userId: "usr_x23d2f2"          # = userRecordID.recordName
        displayName: "2001 Y"
        avatarAsset: null
        faceTimeID: "facetime@example.com"  # or "+819012345678"

    RoomListEntry:
      - sharedZoneOwnerName: "__CKUSER__abc123"
        sharedZoneName: "room_g32wf23f1"
        roomRecordName: "__ROOM____01JROOMA"
        roomName: "é›‘è«‡"
        roomImageAsset: null
        lastMessageText: "ãã‚Œã§OKã§ã™ï¼"
        lastMessageAt: "2025-09-09T09:12:00Z"
        lastReadAt: "2025-09-09T09:10:00Z"
        unreadCount: 2

      - sharedZoneOwnerName: "__CKUSER__def456"
        sharedZoneName: "room_g78jk4l1"
        roomRecordName: "__ROOM____01JROOMB"
        roomName: "é–‹ç™º"
        roomImageAsset: null
        lastMessageText: "ãƒ“ãƒ«ãƒ‰é€šã£ãŸ ğŸ‰"
        lastMessageAt: "2025-09-09T08:40:00Z"
        lastReadAt: "2025-09-09T08:35:00Z"
        unreadCount: 1

  # ãƒ«ãƒ¼ãƒ ã€Œé›‘è«‡ã€ã®å…±æœ‰ã‚¾ãƒ¼ãƒ³ä¾‹ï¼ˆ3äºº: 2001 Y / Alice / Bobï¼‰
  shared_room_g32wf23f1:
    Room:
      - roomID: "room_g32wf23f1"             # = shared zoneName
        name: "é›‘è«‡"
        shareURL: "https://icloud.com/â€¦"  # â€œä½œæˆè€…â€ã¯ CKShare.owner ã‚’éƒ½åº¦å–å¾—ã—ã¦è¡¨ç¤º
        roomImageShape: 2
        roomImageAsset: null

    RoomMember:
      - parent: "ref:Room(__ROOM____01JROOMA)"
        userId: "usr_x23d2f2"
        displayName: "2001 Y"
        avatarAsset: null
      - parent: "ref:Room(__ROOM____01JROOMA)"
        userId: "usr_alice"
        displayName: "Alice"
        avatarAsset: null
      - parent: "ref:Room(__ROOM____01JROOMA)"
        userId: "usr_bob"
        displayName: "Bob"
        avatarAsset: null

    Message:
      - parent: "ref:Room(__ROOM____01JROOMA)"
        senderMemberRef: "ref:RoomMember(__MEMBER__Y01)"   # 2001 Y
        type: "txt"
        text: "ã‚„ã£ã»ãƒ¼"

      - parent: "ref:Room(__ROOM____01JROOMA)"
        senderMemberRef: "ref:RoomMember(__MEMBER__A01)"   # Alice
        type: "txt"
        text: "ä»Šæ—¥ã®ãƒ©ãƒ³ãƒã©ã†ã™ã‚‹ï¼Ÿ"

      - parent: "ref:Room(__ROOM____01JROOMA)"
        senderMemberRef: "ref:RoomMember(__MEMBER__B01)"   # Bob
        type: "attachment"
        text: null
        # æ·»ä»˜æœ¬ä½“ã¯ä¸‹ã® MessageAttachmentï¼ˆã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¦ªï¼‰

      - parent: "ref:Room(__ROOM____01JROOMA)"
        senderMemberRef: "ref:RoomMember(__MEMBER__Y01)"   # 2001 Y
        type: "txt"
        text: "ãã‚Œã§OKã§ã™ï¼"

    MessageAttachment:
      - parent: "ref:Message(__MSG_____ATT1)"   # ä¸Šã® Bob ã®æ·»ä»˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ¬ã‚³ãƒ¼ãƒ‰åã‚’æƒ³å®š
        type: "image"
        asset: "(CKAsset)â€¦"

    Reaction:
      - parent: "ref:Message(__MSG_____0001)"   # 1ã¤ç›®ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆ2001 Yã®â€œã‚„ã£ã»ãƒ¼â€ï¼‰ã«å¯¾ã—ã¦
        memberRef: "ref:RoomMember(__MEMBER__A01)"   # Alice
        emoji: "ğŸ‘"
      - parent: "ref:Message(__MSG_____0002)"   # 2ã¤ç›®ï¼ˆAliceã®â€œãƒ©ãƒ³ãƒã©ã†ã™ã‚‹ï¼Ÿâ€ï¼‰
        memberRef: "ref:RoomMember(__MEMBER__Y01)"   # 2001 Y
        emoji: "â¤ï¸"
      - parent: "ref:Message(__MSG_____0004)"   # 4ã¤ç›®ï¼ˆ2001 Yã®â€œãã‚Œã§OKã§ã™ï¼â€ï¼‰
        memberRef: "ref:RoomMember(__MEMBER__B01)"   # Bob
        emoji: "ğŸ‘"

    RTCSignal:
      - parent: "ref:Room(__ROOM____01JROOMA)"
        fromMemberRef: "ref:RoomMember(__MEMBER__A01)"  # Alice
        toMemberRef:   "ref:RoomMember(__MEMBER__B01)"  # Bob
        type: "offer"
        payload: '{"type":"offer","sdp":"..."}'
        consumed: false
        ttlSeconds: 600

      - parent: "ref:Room(__ROOM____01JROOMA)"
        fromMemberRef: "ref:RoomMember(__MEMBER__B01)"  # Bob
        toMemberRef:   "ref:RoomMember(__MEMBER__A01)"  # Alice
        type: "answer"
        payload: '{"type":"answer","sdp":"..."}'
        consumed: false
        ttlSeconds: 600

      - parent: "ref:Room(__ROOM____01JROOMA)"
        fromMemberRef: "ref:RoomMember(__MEMBER__Y01)"  # 2001 Y
        toMemberRef:   "ref:RoomMember(__MEMBER__A01)"  # Alice
        type: "ice"
        payload: '{"candidate":"candidate:0 1 udp 2122260223 192.0.2.1 54321 typ host","sdpMid":"0","sdpMLineIndex":0}'
        consumed: false
        ttlSeconds: 120

  # åˆ¥ãƒ«ãƒ¼ãƒ ã€Œé–‹ç™ºã€ã®å…±æœ‰ã‚¾ãƒ¼ãƒ³ä¾‹ï¼ˆ2äºº: 2001 Y / Aliceï¼‰
  shared_room_g78jk4l1:
    Room:
      - roomID: "room_g78jk4l1"
        name: "é–‹ç™º"
        shareURL: "https://icloud.com/â€¦"
        roomImageShape: 4
        roomImageAsset: null

    RoomMember:
      - parent: "ref:Room(__ROOM____01JROOMB)"
        userId: "usr_x23d2f2"
        displayName: "2001 Y"
        avatarAsset: null
      - parent: "ref:Room(__ROOM____01JROOMB)"
        userId: "usr_alice"
        displayName: "Alice"
        avatarAsset: null

    Message:
      - parent: "ref:Room(__ROOM____01JROOMB)"
        senderMemberRef: "ref:RoomMember(__MEMBER__A02)"   # Alice
        type: "txt"
        text: "ãƒ“ãƒ«ãƒ‰é€šã£ãŸ ğŸ‰"
