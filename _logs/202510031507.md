# 2025-10-03 15:07 ログタイムライン

## オーナー側ルーム (room_AF6F13C7)
1. ✅ **起動〜初期化** – `CloudKitChatManager` が環境チェックと AUTO RESET を完了し、private/shared 両DBのサブスクリプションと `CKSyncEngine` を起動。
2. ✅ **チュートリアル同期** – ゾーン解決が private scope で成功し、シード済み 8 件のメッセージが `MessageSyncPipeline` で生成→UIに反映。
3. ⚠️ **シグナル初期化** – `resolveZone(signal)` が private を返した状態で `ensureOwnerParticipant` が連続実行され、push 毎に zone subscription を張り直す挙動が継続。
4. ❌ **WebRTC 準備失敗** – カメラ起動で `FigCaptureSourceRemote err=-17281`、Mailbox 更新では `Server Record Changed` / `Zone Busy` が多発し、ICE 候補・offer 公開がリトライループ。
5. ❌ **プロフィール取得失敗** – `ChatView` のリモートプロフィール更新が `CKError Unknown Item` で繰り返し失敗し、根本的なシグナリング競合が解消されず push→sync→owner participant 追加のループが継続。

## 参加者側ルーム (room_0025D1E2)
1. ✅ **シェア受諾フロー** – プレ診断後に `CKAcceptSharesOperation` が成功し、共有ゾーン `room_0025D1E2` が shared scope で検出。参加者ジョインメッセージも投稿。
2. ⚠️ **ルーム登録** – `ChatRoom` が remoteUserID 空のまま作成され、`resolveDatabaseAndZone` は shared を返すが、`Failed to infer remote participant` (Invalid Arguments) が発生。
3. ⚠️ **UI 表示** – `openChat` 後に `MessageStore` は shared ゾーンを参照しリフレッシュするが、ローカル件数 0 の状態が継続し push→手動同期が頻発。
4. ❌ **P2P シグナル** – `startIfNeeded` が remote 未確定のまま実行され、Mailbox 書き込みで `Server Record Changed` が連続発生。ICE/offer 更新は全て CKError で失敗。
5. ❌ **リモート未解決ループ** – プロフィール取得がスキップされ、`resolveZone(signal)` と zone subscription 再設定が連鎖し続けるため、共有ゾーン側でもシグナリングが安定せず、正常な peer 設定に至らない。

> ⚠️ 注: 両ルームとも push → 手動同期 → シグナル再試行 → zone subscription 再設定のループが顕著で、Mailbox 書き込み競合とリモート参加者解決失敗が共通課題になっています。
